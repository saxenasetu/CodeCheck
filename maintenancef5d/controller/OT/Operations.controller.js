sap.ui.define(["com/eramet/maintenanceF5D/controller/BaseController","com/eramet/maintenanceF5D/util/util","com/eramet/maintenanceF5D/util/formatter","sap/m/MessageBox"],function(e,t,s,i){return e.extend("com.eramet.maintenanceF5D.controller.OT.Operations",{aChangedButtons:[],onInit:function(){this.getRouter().attachRoutePatternMatched(this._onRouteMatched,this)},_onRouteMatched:function(e){if(e.getParameter("name")==="Operations"){var s=this.getView().getModel("i18n").getResourceBundle().getText("operationsTitle");if(t.aCreatedOT.length>0){for(var i=0;i<t.aOTElements.length;i++){if(t.aCreatedOT===t.aOTElements[i].OrderId){t.oSelectedOT=t.aCreatedOT;t.oSelectedOTFull=t.aOTElements[i];t.aCreatedOT="";break}}}if(t.oSelectedOT&&t.oSelectedOTFull){this.getView().byId("otNumber").setText(t.oSelectedOT);this.getView().byId("finalText").setText(t.oSelectedOT);this.getView().byId("finalText").setTooltip(t.oSelectedOT);this.getView().byId("desc").setText(t.oSelectedOTFull.ShortText);this.getView().byId("date").setText(com.eramet.maintenanceF5D.util.formatter.avisDate(t.oSelectedOTFull.StartDate));t.sTitleText=s;this.setTitle();this._resetModel();this._resetIcons();if(t.oSelectedOTFull.Priority==="3"&&t.oSelectedOTFull.OrderType==="ZM03"){this.getView().byId("add").setVisible(false);this.getView().byId("tree").setVisible(false);this.getView().byId("list").setVisible(true);this.getView().byId("list2").setVisible(true);this.getView().byId("rondierStartDate").setDateValue(t.oSelectedOTFull.StartDate);this.getView().byId("rondierEndDate").setDateValue(t.oSelectedOTFull.FinishDate)}else{this.getView().byId("add").setVisible(true);this.getView().byId("tree").setVisible(true);this.getView().byId("list").setVisible(false);this.getView().byId("list2").setVisible(false)}}}},_resetModel:function(e){if(t.oSelectedOTFull.HeaderToOperations.results&&t.oSelectedOTFull.HeaderToOperations.results.length>0){if(t.oSelectedOTFull.Priority==="3"&&t.oSelectedOTFull.OrderType==="ZM03"){e=true;this._resetRondierModel()}else{this.getView().byId("tree").setBusy(true);this.treeModel(t.oSelectedOTFull.HeaderToOperations.results);this._resetIcons();var e=false;this.getView().byId("tree").setBusy(false)}if(e){this.getView().byId("save").setVisible(true);this.getView().byId("add").setVisible(false)}else{this.getView().byId("save").setVisible(false);this.getView().byId("add").setVisible(true)}}},_resetRondierModel:function(){var e=com.eramet.maintenanceF5D.Component.getMetadata().getManifestEntry("sap.app").dataSources["ZUI5_GW_PM_ORDER_SRV"].uri,s=new sap.ui.model.odata.ODataModel(e,true),a=this;s.read("/OrderHeaderSet?$expand=HeaderToOperations/MeausurementPoint",null,null,false,function(e){if(e&&e.results&&e.results.length&&e.results.length>0){var s=e.results,i=[];for(var r=0;r<s.length;r++){if(t.oSelectedOTFull.OrderId===s[r].OrderId){var o=s[r].HeaderToOperations.results;if(o.length>0){for(var n=0;n<o.length;n++){var l=o[n].MeausurementPoint.results;for(var d=0;d<l.length;d++){l[d].OperationDesc=o[n].Description;i.push(l[d])}}}}}a.rondierModel(i)}else{alert("Empty OrderHeaderSet odata!")}}.bind(this),function(e){var t=""+JSON.stringify(e.responseText.split('"message"')[1].split('"value"')[1].split('"innererror"')[0]);t=t.split(":")[1].split("},")[0];var s=t.substring(2,t.length-2);i.error(s,{styleClass:"sapUiSizeCompact"})}.bind(this))},backToHome:function(){this.getRouter().navTo("Home")},backToFollowup:function(){this.getRouter().navTo("Followup")},onPressSaveMeasurement:function(){var e=com.eramet.maintenanceF5D.Component.getMetadata().getManifestEntry("sap.app").dataSources["ZUI5_GW_PM_ORDER_SRV"].uri,t=new sap.ui.model.odata.v2.ODataModel(e,true),s={OrderNumber:"400000146",MeasuringPointNumber:"54",OperationNumber:"0010",MeasuredValue:"12.0"},a=this;t.create("/MeasurementDocumentSet",s,{success:function(e){var t=a;i.success("Successfully saved",{styleClass:"sapUiSizeCompact",actions:["OK"],onClose:function(e){if(e==="OK"){t.backToFollowup()}}})},error:function(e){var t=""+JSON.stringify(e.responseText.split('"message"')[1].split('"value"')[1].split('"innererror"')[0]);t=t.split(":")[1].split("},")[0];var s=t.substring(2,t.length-2);var r=a;i.error(s,{styleClass:"sapUiSizeCompact",actions:["OK"],onClose:function(e){if(e==="OK"){r.backToFollowup()}}})}})},onPressNavToOTDetail:function(){this.getRouter().navTo("OTDetail")},onPressNavToOpDetail:function(e){var s=e.getSource().sId;s=s.split("tree-")[1];t.sOperationName=this.getView().byId("tree").getModel("treeModel").getData()[s];this.getRouter().navTo("ToOpDetail")},onPressChangeIcon:function(e){var t=sap.ui.getCore().byId(e.getSource().sId).getIcon();if(t==="sap-icon://synchronize"){sap.ui.getCore().byId(e.getSource().sId).setIcon("sap-icon://accept");sap.ui.getCore().byId(e.getSource().sId).setType("Accept");this.aChangedButtons.push(e.getSource().sId)}else{sap.ui.getCore().byId(e.getSource().sId).setIcon("sap-icon://synchronize");sap.ui.getCore().byId(e.getSource().sId).setType("Default");var s=this.aChangedButtons;var i=e.getSource().sId;for(var a=s.length-1;a>=0;a--){if(s[a]===i){s.splice(a,1);break}}}},_resetIcons:function(){for(var e=0;e<this.aChangedButtons.length;e++){if(sap.ui.getCore().byId(this.aChangedButtons[e])){sap.ui.getCore().byId(this.aChangedButtons[e]).setType("Default");sap.ui.getCore().byId(this.aChangedButtons[e]).setIcon("sap-icon://synchronize")}}this.aChangedButtons=[]},onPressConform:function(e){var t=false,s=sap.ui.getCore();if(s.byId(e.getSource().sId).getType()==="Accept"){t=true}if(t){s.byId(e.getSource().sId).setType("Default")}else{s.byId(e.getSource().sId).setType("Accept");s.byId(e.getSource().oParent.getItems()[1].sId).setType("Default")}},onPressNonConform:function(e){var t=false,s=sap.ui.getCore();if(s.byId(e.getSource().sId).getType()==="Reject"){t=true}if(t){s.byId(e.getSource().sId).setType("Default")}else{s.byId(e.getSource().sId).setType("Reject");s.byId(e.getSource().oParent.getItems()[0].sId).setType("Default")}},_resetConformButtons:function(e){var t=sap.ui.getCore(),s=this.getView().byId("list2").getItems();for(var i=0;i<s.length;i++){for(var a=0;a<s[i].getContent()[0].getItems()[2].getItems().length;a++){t.byId(s[i].getContent()[0].getItems()[2].getItems()[a].sId).setType("Default")}}if(e){this.getView().byId("save").setVisible(true);this.getView().byId("add").setVisible(false)}else{this.getView().byId("save").setVisible(false);this.getView().byId("add").setVisible(true)}},onPressAdd:function(){t.sOperationName={OperationNumber:this.getView().getModel("i18n").getResourceBundle().getText("toOpDetailNewOperation"),Description:""};this.getRouter().navTo("ToOpDetail")}})});