sap.ui.define(["com/eramet/maintenanceF5D/controller/BaseController","com/eramet/maintenanceF5D/util/util","com/eramet/maintenanceF5D/util/formatter"],function(e,t,i){"use strict";return e.extend("com.eramet.depanneur.HATDepanneurApp.controller.Followup",{onInit:function(){this.getRouter().attachRoutePatternMatched(this._onRouteMatched,this)},_onRouteMatched:function(e){if(e.getParameter("name")==="Followup"){this._resetModel();this.getView().byId("prio").setSelectedKey("");this.getView().byId("type").setSelectedKey("");this.getView().byId("type").setEnabled(true);if(t.sCustomer==="R"){this.getView().byId("prio").setSelectedKey("3");this.getView().byId("type").setSelectedKey("2");this.getView().byId("type").setEnabled(false);this.onSelectItem()}else if(t.sCustomer==="D"){this.getView().byId("type").setSelectedKey("1");this.onSelectItem()}}},backToHome:function(){this._resetDatas();this.getRouter().navTo("Home")},onPressNavBack:function(){this._resetDatas();this.getRouter().navTo("WorkPage")},onPressNavToOTDetail:function(e){this._resetDatas();var i=e.getSource().oBindingContexts.followupListModel.sPath.split("/")[1],s=this.getModel("followupListModel").getData();t.oSelectedOT=s[i].title.split("N° ")[1];t.oSelectedOTFull=s[i];this.getRouter().navTo("Operations")},_resetModel:function(){var e=[{title:"N° OT 0000001",text:"Tube qui fuit",date:"21/10/2019",equipement:"Trousse de réparation",status:"Faible",prio:"Prio 1",codePoste:"code poste technique 1",description:"Description courte 1",type:"Correctif"},{title:"N° OT 0000002",text:"Verre brisé",date:"18/10/2019",equipement:"Verre coupé à la taille",status:"Moyenne",prio:"Prio 3",codePoste:"code poste technique 2",description:"Description courte 2",type:"Préventif"},{title:"N° OT 0000003",text:"Plateau cassé",date:"17/10/2019",equipement:"Charpentier",status:"Majeure",prio:"Prio 3",codePoste:"code poste technique 3",description:"Description courte 3",type:"Correctif"},{title:"N° OT 0000004",text:"Pas de chauffage",date:"21/10/2019",equipement:"Mécanicien en chauffage",status:"Faible",prio:"Prio 2",codePoste:"code poste technique 4",description:"Description courte 4",type:"Préventif"},{title:"N° OT 0000005",text:"Casier cassé",date:"15/10/2019",equipement:"Serrurier",status:"Majeure",prio:"Prio 1",codePoste:"code poste technique 5",description:"Description courte 5",type:"Correctif"}];t.aOTElements=e;this.followupListModel(e)},onOpenOTSearchDialog:function(e){var t=sap.ui.xmlfragment("com.eramet.depanneur.HATDepanneurApp.view.fragment.searchOT",this);this.getView().addDependent(t);this._resetModel();t.open()},onPressAccept:function(){var e=sap.ui.getCore(),i=e.byId("searchField").getSuggestionItems()[0].getText(),s={};if(t.aFilteredOT.length>0){this._resetModel();this.followupListModel(t.aFilteredOT)}else{for(var o=0;o<this.getModel("followupListModel").getData().length;o++){if(i===this.getModel("followupListModel").getData()[o].title){s=this.getModel("followupListModel").getData()[o];break}}this.followupListModel([s])}this.onPressClose()},onPressClose:function(){var e=sap.ui.getCore();e.byId("searchOTDialog").close();e.byId("searchOTDialog").destroy()},onSuggest:function(e){var t=e.getParameter("suggestValue"),i=[],s=sap.ui.getCore();if(t){i=[new sap.ui.model.Filter([new sap.ui.model.Filter("title",function(e){return(e||"").toUpperCase().indexOf(t.toUpperCase())>-1}),new sap.ui.model.Filter("date",function(e){return(e||"").toUpperCase().indexOf(t.toUpperCase())>-1}),new sap.ui.model.Filter("status",function(e){return(e||"").toUpperCase().indexOf(t.toUpperCase())>-1}),new sap.ui.model.Filter("prio",function(e){return(e||"").toUpperCase().indexOf(t.toUpperCase())>-1}),new sap.ui.model.Filter("text",function(e){return(e||"").toUpperCase().indexOf(t.toUpperCase())>-1}),new sap.ui.model.Filter("codePoste",function(e){return(e||"").toUpperCase().indexOf(t.toUpperCase())>-1}),new sap.ui.model.Filter("description",function(e){return(e||"").toUpperCase().indexOf(t.toUpperCase())>-1})],false)]}s.byId("searchField").getBinding("suggestionItems").filter(i);s.byId("searchField").suggest()},onSearch:function(e){var i=sap.ui.getCore();t.aFilteredOT=[];var s=e.getParameter("suggestionItem");if(s===undefined){if(i.byId("searchField").mBindingInfos&&i.byId("searchField").mBindingInfos.suggestionItems&&i.byId("searchField").mBindingInfos.suggestionItems.binding&&i.byId("searchField").mBindingInfos.suggestionItems.binding.aIndices&&i.byId("searchField").mBindingInfos.suggestionItems.binding.aIndices.length>0){var o=[],n=this.getModel("followupListModel").getData();for(var r=0;r<i.byId("searchField").mBindingInfos.suggestionItems.binding.aIndices.length;r++){o.push(n[i.byId("searchField").mBindingInfos.suggestionItems.binding.aIndices[r]])}t.aFilteredOT=o}}},_resetDatas:function(){this._resetIcons()},_resetIcons:function(){this.getView().byId("date").setIcon("");this.getView().byId("prio").setIcon("");this.getView().byId("statut").setIcon("")},onPressDate:function(){var e="";if(this.getView().byId("date").getIcon!==""){if(this.getView().byId("date").getIcon()==="sap-icon://up"){this.getView().byId("date").setIcon("sap-icon://down");e=true}else{this.getView().byId("date").setIcon("sap-icon://up");e=false}}else{this.getView().byId("date").setIcon("sap-icon://up");e=false}this.getView().byId("statut").setIcon("");this.getView().byId("followupList").getBinding("items").sort(new sap.ui.model.Sorter("date",e,false))},onSelectItem:function(){var e=[],t=this.getView().byId("prio").getSelectedItem()?this.getView().byId("prio").getSelectedItem().getText():"",i=this.getView().byId("type").getSelectedItem()?this.getView().byId("type").getSelectedItem().getText():"";if(i===this.getView().getModel("i18n").getResourceBundle().getText("followupType3")){i=""}console.log("sItemPrio: ",t,"sItemType: ",i);e=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("prio",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("type",sap.ui.model.FilterOperator.Contains,i)],and:true});console.log("aFilters: ",e);this.getView().byId("followupList").getBinding("items").filter(e)},onPressStaut:function(){var e="";if(this.getView().byId("statut").getIcon!==""){if(this.getView().byId("statut").getIcon()==="sap-icon://up"){this.getView().byId("statut").setIcon("sap-icon://down");e=true}else{this.getView().byId("statut").setIcon("sap-icon://up");e=false}}else{this.getView().byId("statut").setIcon("sap-icon://up");e=false}this.getView().byId("date").setIcon("");this.getView().byId("followupList").getBinding("items").sort(new sap.ui.model.Sorter("status",e,false))}})});