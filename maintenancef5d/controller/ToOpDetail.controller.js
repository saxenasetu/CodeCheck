sap.ui.define(["com/eramet/maintenanceF5D/controller/BaseController","com/eramet/maintenanceF5D/util/util","com/eramet/maintenanceF5D/util/formatter","sap/m/MessageBox","sap/m/upload/Uploader","sap/m/StandardListItem","sap/ui/core/Item","sap/m/library","sap/ui/model/json/JSONModel"],function(e,t,o,n,i,a,s,r,l){"use strict";return e.extend("com.eramet.depanneur.HATDepanneurApp.controller.ToOpDetail",{onInit:function(){this.getRouter().attachRoutePatternMatched(this._onRouteMatched,this)},_onRouteMatched:function(e){if(e.getParameter("name")==="ToOpDetail"){var o=this.getView().getModel("i18n").getResourceBundle().getText("toOpDetailTitle");this.getView().byId("finalText").setText(t.oSelectedOT);this.getView().byId("finalText").setTooltip(t.oSelectedOT);this.treeModel(t.sOperationName);this.getView().byId("subOperations").setText(t.sOperationName.operation);this.getView().byId("toOpDetail").setTitle(o+" "+t.sOperationName.operation.split(" ")[2]);this.getView().byId("finalText2").setText(o+" "+t.sOperationName.operation.split(" ")[2]);this.getView().byId("finalText2").setTooltip(o+" "+t.sOperationName.operation.split(" ")[2]);this._resetContent()}},backToHome:function(){this._resetContent();this.getRouter().navTo("Home")},backToWorkPage:function(){this.getRouter().navTo("WorkPage")},backToFollowup:function(){this._resetContent();this.getRouter().navTo("Followup")},onPressOTDetail:function(){this._resetContent();this.getRouter().navTo("OTDetail")},backToOperations:function(){this._resetContent();this.getRouter().navTo("Operations")},onPressNavBack:function(){this._resetContent();this.getRouter().navTo("Operations")},onPressNavToOTDetail:function(){this.getRouter().navTo("OTDetail")},onPressAdd:function(e){sap.ui.getCore().byId(e.getSource().sId).setVisible(false);var t=this,o=this.getView().byId("list"),n=new sap.ui.layout.form.SimpleForm({columnsL:1,columnsM:1,editable:true,emptySpanL:4,emptySpanM:4,labelSpanL:3,labelSpanM:3,layout:"ResponsiveGridLayout",maxContainerCols:2}),i=new sap.m.CustomListItem({}),a=new sap.m.Label({text:this.getView().getModel("i18n").getResourceBundle().getText("toOpDetailDate1")}),s=new sap.m.DateTimePicker({}),r=new sap.m.Label({text:this.getView().getModel("i18n").getResourceBundle().getText("toOpDetailDate2")}),l=new sap.m.DateTimePicker({}),d=new sap.m.Label({text:this.getView().getModel("i18n").getResourceBundle().getText("toOpDetailIntervenant")}),p=new sap.m.Input({});n.addContent(a);n.addContent(s);n.addContent(r);n.addContent(l);n.addContent(d);n.addContent(p);i.addContent(n);var u=new sap.m.Bar({contentRight:[new sap.m.Button({icon:"sap-icon://sys-minus",press:function(e){t.onPressRemove(e)}}),new sap.m.Button({icon:"sap-icon://sys-add",press:function(e){t.onPressAdd(e)}})]});i.addContent(u);o.addItem(i)},onPressRemove:function(e){var t=this.getView().byId("list");if(t.getItems().length!==1){if(e.getSource().oParent.oParent.sId===t.getItems()[t.getItems().length-1].sId){sap.ui.getCore().byId(t.getItems()[t.getItems().length-2].getContent()[1].getContentRight()[1].sId).setVisible(true)}t.removeItem(e.getSource().oParent.oParent.sId)}},_resetContent:function(){var e=this.getView().byId("additionalBox").getContent().length;if(e>6){for(var t=e-1;t>6;t--){this.getView().byId("additionalBox").removeContent(t)}}},onPressSave:function(){var e=this.getView().getModel("i18n").getResourceBundle().getText("toOpDetailConfirmText"),t=this.getView().getModel("i18n").getResourceBundle().getText("toOpDetailTitleText"),o=this.getView().getModel("i18n").getResourceBundle().getText("toOpDetailFermer"),i=this.getView().getModel("i18n").getResourceBundle().getText("toOpDetailSave");n.confirm(e,{title:t,actions:[i,o],onClose:function(e){}})},onPressArticle:function(){this.getRouter().navTo("Article")},onPressCamera:function(){function e(e){alert("success")}function t(e){alert("fail"+e)}navigator.camera.getPicture(e,t,{quality:50,destinationType:Camera.DestinationType.DATA_URL})},onPressFileBrowser:function(){var e=sap.ui.xmlfragment("com.eramet.depanneur.HATDepanneurApp.view.fragment.fileUpload",this);this.getView().addDependent(e);e.open();var t=sap.ui.require.toUrl("com/eramet/maintenanceF5D/model")+"/items.json",o=sap.ui.getCore().byId("UploadSet");this.getView().setModel(new l(t));o.getList().setMode(r.ListMode.MultiSelect);o.getDefaultFileUploader().setButtonOnly(false);o.getDefaultFileUploader().setIcon("sap-icon://attachment")},onItemAdded:function(e){var t=[],o=sap.ui.getCore(),n={fileName:e.getParameters().item.mProperties.fileName,mediaType:e.getParameters().item.mProperties.mediaType,uploadState:e.getParameters().item.mProperties.uploadState};t.push(n);for(var i=0;i<o.byId("UploadSet").mBindingInfos.items.binding.oList.length;i++){t.push(o.byId("UploadSet").mBindingInfos.items.binding.oList[i])}console.log("aItems: ",t);this.uploadedModel(t)},onUploadSelectedButton:function(){console.log("is it working?");var e=sap.ui.getCore().byId("UploadSet");console.log("uploadedModel:",this.getView().getModel("uploadedModel").getData());console.log("oUploadSet:",e);console.log("oUploadSet:",e._mListItemIdToItemMap);e.upload(e._oList.getItems())},onDownloadSelectedButton:function(){var e=sap.ui.getCore().byId("UploadSet");e.getItems().forEach(function(e){if(e.getListItem().getSelected()){e.download(true)}})},onPressClose:function(){var e=sap.ui.getCore();e.byId("uploadDialog").close();e.byId("uploadDialog").destroy()}})});