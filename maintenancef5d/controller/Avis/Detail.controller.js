sap.ui.define(["com/eramet/maintenanceF5D/controller/BaseController","com/eramet/maintenanceF5D/util/util","com/eramet/maintenanceF5D/util/formatter","sap/m/MessageBox"],function(e,t,s,i){"use strict";return e.extend("com.eramet.maintenanceF5D.controller.Avis.Detail",{onInit:function(){this.getRouter().attachRoutePatternMatched(this._onRouteMatched,this)},_onRouteMatched:function(e){if(e.getParameter("name")==="Detail"){var s=t.sSelectedTile.split("--")[1],i="",n="";n=this.getView().getModel("i18n").getResourceBundle().getText("avisTitle");this._resetModel();t.sTitleText=n;this.setTitle()}},onAfterRendering:function(){this._setColors()},onPressRefresh:function(){this.getView().byId("detailList").setBusy(true);this._resetModel();this.getView().byId("detailList").setBusy(false)},_resetModel:function(){var e=com.eramet.maintenanceF5D.Component.getMetadata().getManifestEntry("sap.app").dataSources["ZUI5_GW_PM_NOTIF_SRV"].uri,s=new sap.ui.model.odata.ODataModel(e,true),n=this;this.getView().byId("detailList").setBusy(true);s.read("NotificationHeaderSet?$expand=Items",null,null,false,function(e){if(e&&e.results&&e.results.length&&e.results.length>0){t.aElements=e.results;n.listModel(e.results);console.log("oData:",e);n._setColors();n.getView().byId("detailList").setBusy(false)}else{alert("Empty NotificationHeaderSet odata!");n.getView().byId("detailList").setBusy(false)}},function(e){var t=""+JSON.stringify(e.responseText.split('"message"')[1].split('"value"')[1].split('"innererror"')[0]);t=t.split(":")[1].split("},")[0];var s=t.substring(2,t.length-2);n.getView().byId("detailList").setBusy(false);i.error(s,{styleClass:"sapUiSizeCompact"})})},_setColors:function(){var e=this,t=[];if(e.getView().getModel("listModel")&&e.getView().getModel("listModel").getData()){var s=this.getView().byId("detailList").getItems();for(var i=0;i<s.length;i++){s[i].getContent()[0].getItems()[0].removeStyleClass("darkrRedCell");s[i].getContent()[0].getItems()[0].removeStyleClass("redCell");s[i].getContent()[0].getItems()[0].removeStyleClass("orangeCell");s[i].getContent()[0].getItems()[0].removeStyleClass("yellowCell")}for(var i=0;i<s.length;i++){if(s[i].getContent()[0].getItems()[0].getItems()[0].getText()==="+"){s[i].getContent()[0].getItems()[0].addStyleClass("darkrRedCell")}else if(s[i].getContent()[0].getItems()[0].getItems()[0].getText()==="A"){s[i].getContent()[0].getItems()[0].addStyleClass("redCell")}else if(s[i].getContent()[0].getItems()[0].getItems()[0].getText()==="B"){s[i].getContent()[0].getItems()[0].addStyleClass("orangeCell")}else if(s[i].getContent()[0].getItems()[0].getItems()[0].getText()==="C"){s[i].getContent()[0].getItems()[0].addStyleClass("yellowCell")}else{}}}},backToHome:function(){this._resetDatas();this.getRouter().navTo("Home")},onPressNavBack:function(){this._resetDatas();this.getRouter().navTo("Home")},onPressNavToAvisDetail:function(e){var s=e.getSource().oBindingContexts.listModel.sPath;s=s.split("/")[1];if(s.indexOf("/")>-1){s=s.split("/")[0]}t.aDetailAvis=this.getView().byId("detailList").getModel("listModel").getData()[s];var n=com.eramet.maintenanceF5D.Component.getMetadata().getManifestEntry("sap.app").dataSources["ZUI5_GW_PM_NOTIF_SRV"].uri,o=new sap.ui.model.odata.ODataModel(n,true),a=this;o.read("NotificationHeaderSet('"+this.getView().byId("detailList").getModel("listModel").getData()[s].NotificationNumber+"')",null,null,false,function(e){console.log("oData:",e);a.getRouter().navTo("AvisDetail")},function(e){var t=""+JSON.stringify(e.responseText.split('"message"')[1].split('"value"')[1].split('"innererror"')[0]);t=t.split(":")[1].split("},")[0];var s=t.substring(2,t.length-2);i.error(s,{styleClass:"sapUiSizeCompact"})})},onPressAdd:function(){t.aDetailAvis=[];this.getRouter().navTo("AvisDetail")},_resetDatas:function(){t.sSelectedTile="";this._resetIcons()},onOpenSearchDialog:function(e){var t=sap.ui.xmlfragment("com.eramet.maintenanceF5D.view.fragment.search",this);this.getView().addDependent(t);this._resetModel();t.open()},onPressAccept:function(){var e=sap.ui.getCore(),s=e.byId("searchField").getSuggestionItems()[0].getText(),i={};if(t.aFilteredAvis.length>0){this.listModel(t.aFilteredAvis)}else{for(var n=0;n<this.getModel("listModel").getData().length;n++){if(s===this.getModel("listModel").getData()[n].NotificationNumber){i=this.getModel("listModel").getData()[n];break}}this.listModel([i])}this.onPressClose();this._setColors()},onPressClose:function(){var e=sap.ui.getCore();e.byId("searchDialog").close();e.byId("searchDialog").destroy()},onSuggest:function(e){var t=e.getParameter("suggestValue"),s=[],i=sap.ui.getCore();if(t){s=[new sap.ui.model.Filter([new sap.ui.model.Filter("NotificationNumber",function(e){return(e||"").toUpperCase().indexOf(t.toUpperCase())>-1}),new sap.ui.model.Filter("ShortText",function(e){return(e||"").toUpperCase().indexOf(t.toUpperCase())>-1}),new sap.ui.model.Filter("TechnicalObjectNumber",function(e){return(e||"").toUpperCase().indexOf(t.toUpperCase())>-1}),new sap.ui.model.Filter("Effect",function(e){return(e||"").toUpperCase().indexOf(t.toUpperCase())>-1})],false)]}i.byId("searchField").getBinding("suggestionItems").filter(s);i.byId("searchField").suggest()},onSearch:function(e){var s=sap.ui.getCore();t.aFilteredAvis=[];var i=e.getParameter("suggestionItem");if(i===undefined){if(s.byId("searchField").mBindingInfos&&s.byId("searchField").mBindingInfos.suggestionItems&&s.byId("searchField").mBindingInfos.suggestionItems.binding&&s.byId("searchField").mBindingInfos.suggestionItems.binding.aIndices&&s.byId("searchField").mBindingInfos.suggestionItems.binding.aIndices.length>0){var n=[],o=this.getModel("listModel").getData();for(var a=0;a<s.byId("searchField").mBindingInfos.suggestionItems.binding.aIndices.length;a++){n.push(o[s.byId("searchField").mBindingInfos.suggestionItems.binding.aIndices[a]])}t.aFilteredAvis=n}}},onPressCriticality:function(){var e="";if(this.getView().byId("critical").getIcon!==""){if(this.getView().byId("critical").getIcon()==="sap-icon://up"){this.getView().byId("critical").setIcon("sap-icon://down");e=true}else{this.getView().byId("critical").setIcon("sap-icon://up");e=false}}else{this.getView().byId("critical").setIcon("sap-icon://up");e=false}this.getView().byId("date").setIcon("");this.getView().byId("repercussion").setIcon("");this.getView().byId("detailList").getBinding("items").sort(new sap.ui.model.Sorter("ABCIndicator",e,false));this._setColors()},onPressDate:function(){var e="";if(this.getView().byId("date").getIcon!==""){if(this.getView().byId("date").getIcon()==="sap-icon://up"){this.getView().byId("date").setIcon("sap-icon://down");e=true}else{this.getView().byId("date").setIcon("sap-icon://up");e=false}}else{this.getView().byId("date").setIcon("sap-icon://up");e=false}this.getView().byId("critical").setIcon("");this.getView().byId("repercussion").setIcon("");this.getView().byId("detailList").getBinding("items").sort(new sap.ui.model.Sorter("NotificationDate",e,false));this._setColors()},onPressRepercussion:function(){var e="";if(this.getView().byId("repercussion").getIcon!==""){if(this.getView().byId("repercussion").getIcon()==="sap-icon://up"){this.getView().byId("repercussion").setIcon("sap-icon://down");e=true}else{this.getView().byId("repercussion").setIcon("sap-icon://up");e=false}}else{this.getView().byId("repercussion").setIcon("sap-icon://up");e=false}this.getView().byId("date").setIcon("");this.getView().byId("critical").setIcon("");this.getView().byId("detailList").getBinding("items").sort(new sap.ui.model.Sorter("Effect",e,false));this._setColors()},_resetIcons:function(){this.getView().byId("date").setIcon("");this.getView().byId("critical").setIcon("");this.getView().byId("repercussion").setIcon("")}})});