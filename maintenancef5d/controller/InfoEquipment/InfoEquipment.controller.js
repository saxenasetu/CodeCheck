sap.ui.define(["com/eramet/maintenanceF5D/controller/BaseController","com/eramet/maintenanceF5D/util/util","com/eramet/maintenanceF5D/util/formatter","sap/m/Popover","sap/m/VBox","sap/m/Button","sap/m/MessageBox"],function(e,t,n,a,i,s,o){"use strict";return e.extend("com.eramet.maintenanceF5D.controller.InfoEquipment.InfoEquipment",{onInit:function(){this.getRouter().attachRoutePatternMatched(this._onRouteMatched,this)},_onRouteMatched:function(e){if(e.getParameter("name")==="InfoEquipment"){this._resetModel();this._resetViewModel();var n=this.getView().getModel("i18n").getResourceBundle().getText("infoEquipmentTitle");t.sTitleText=n;this.setTitle();this.getView().byId("searchField").setEnableSuggestions(false)}},backToHome:function(){this._resetViewModel();this.getRouter().navTo("Home")},_resetModel:function(){var e=com.eramet.maintenanceF5D.Component.getMetadata().getManifestEntry("sap.app").dataSources["EAM_OBJPG_TECHNICALOBJECT_SRV"].uri,n=new sap.ui.model.odata.ODataModel(e,false),a=this;this.getView().byId("searchField").setBusy(true);n.read("C_ObjPgTechnicalObject?sap-language='FR'",null,null,false,function(e){if(e&&e.results&&e.results.length&&e.results.length>0){t.aEquipment=e.results;a.infoEquipmentModel(e.results);a.getView().byId("searchField").setBusy(false)}else{alert("Empty C_ObjPgTechnicalObject odata!")}},function(){alert("C_ObjPgTechnicalObject service fail")})},onChange:function(e){if(this.getView().byId("searchField").getValue().length>=3){this.getView().byId("searchField").setEnableSuggestions(true)}},onSuggest:function(e){this._resetModel();var t=e.getParameter("suggestValue"),n=[];if(t&&t.length>=3){n=[new sap.ui.model.Filter([new sap.ui.model.Filter("TechnicalObjectLabel",function(e){return(e||"").toUpperCase().indexOf(t.toUpperCase())>-1}),new sap.ui.model.Filter("TechnicalObjectDescription",function(e){return(e||"").toUpperCase().indexOf(t.toUpperCase())>-1})],false)];this.getView().byId("searchField").getBinding("suggestionItems").filter(n);this.getView().byId("searchField").suggest()}},onSearch:function(e){t.aEquipment=[];var n=sap.ui.getCore(),a=this.getView().byId("searchField").getValue();if(a&&a.length>=3){for(var i=0;i<this.getView().getModel("infoEquipmentModel").getData().length;i++){if(a===this.getView().getModel("infoEquipmentModel").getData()[i].TechnicalObjectLabel){t.aEquipment=this.getView().getModel("infoEquipmentModel").getData()[i];break}}this.equipmentViewModel(t.aEquipment);if(a){this._createPopover(e);this.getView().byId("equipmentInputs").setVisible(true);this.getView().byId("actions").setEnabled(true);n.byId("nomenclature").setEnabled(true);if(t.sCustomer!=="R"){n.byId("avisRattache").setEnabled(true)}else{n.byId("avisRattache").setEnabled(false)}n.byId("otRattache").setEnabled(true)}else{this.getView().byId("equipmentInputs").setVisible(false);this.getView().byId("actions").setEnabled(false);if(n.byId("nomenclature")&&n.byId("avisRattache")&&n.byId("otRattache")){n.byId("nomenclature").setEnabled(false);n.byId("avisRattache").setEnabled(false);n.byId("otRattache").setEnabled(false)}}}},onPressBarcode:function(){jQuery.sap.require("sap.ndc.BarcodeScanner");var e=this;sap.ndc.BarcodeScanner.scan(function(t){if(t.text){e.getView().byId("searchField").setValue(t.text)}},function(e){alert("Scanning failed: "+e)})},onPressNavToRattaches:function(e){this.getRouter().navTo("Rattaches")},onPressNavToInfoStock:function(){this._resetViewModel();this.getRouter().navTo("InfoStock")},onPressNavToDocumentTech:function(){this._resetViewModel();this.getRouter().navTo("DocumentTech")},_resetViewModel:function(){this.getView().byId("searchField").clear()},_createPopover:function(e){var n=this,o=sap.ui.getCore(),r=this.getView(),l=r.getModel("i18n").getResourceBundle().getText("infoEquipmentButton1"),c=r.getModel("i18n").getResourceBundle().getText("infoEquipmentButton2"),u=r.getModel("i18n").getResourceBundle().getText("infoEquipmentButton3");if(!o.byId("createPopup")){new a("createPopup",{contentWidth:"100%",horizontalScrolling:true,modal:false,offsetX:0,offsetY:0,placement:"Top",showHeader:false,title:"Actions",verticalScrolling:true,visible:true,content:[new i({items:[new s("avisRattache",{width:"100%",text:l,press:function(e){t.sRattachesButtonText=e.getSource().sId;n.onPressNavToRattaches()}}).addStyleClass("customPopoverBtn"),new s("otRattache",{width:"100%",text:c,press:function(e){t.sRattachesButtonText=e.getSource().sId;n.onPressNavToRattaches()}}).addStyleClass("customPopoverBtn"),new s("nomenclature",{width:"100%",text:u,press:function(e){n.onPressNavToInfoStock()}}).addStyleClass("customPopoverBtn")]})]})}},onPressActions:function(e){this._createPopover(e);var t=sap.ui.getCore();t.byId("createPopup").openBy(e.getSource())}})});