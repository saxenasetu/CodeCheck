sap.ui.define(["com/eramet/maintenanceF5D/controller/BaseController","com/eramet/maintenanceF5D/util/util","com/eramet/maintenanceF5D/util/formatter","sap/m/MessageToast"],function(e,t,i,o){"use strict";return e.extend("com.eramet.maintenanceF5D.controller.InfoStock.InfoStock",{aOldValues:[10,5,9,20,3],onInit:function(){this.getRouter().attachRoutePatternMatched(this._onRouteMatched,this)},_onRouteMatched:function(e){if(e.getParameter("name")==="InfoStock"){this._resetModel();this._initStepInputs();this._resetOTModel();var i=this.getView().getModel("i18n").getResourceBundle().getText("infoStockTitle");t.sTitleText=i;this.setTitle()}},backToHome:function(){this.getRouter().navTo("Home")},_resetModel:function(){var e=[{title:"Code article A0001",description:"Description 1",magasin:"Magasin 1",emplacement:"Emplacement magasin 1",quantity:10,date:"21/10/2019",equipement:"Trousse de réparation",status:"Faible"},{title:"Code article A0002",description:"Description 2",magasin:"Magasin 2",emplacement:"Emplacement magasin 2",quantity:5,date:"18/10/2019",equipement:"Verre coupé à la taille",status:"Moyenne"},{title:"Code article A0003",description:"Description 3",magasin:"Magasin 3",emplacement:"Emplacement magasin 3",quantity:9,date:"17/10/2019",equipement:"Charpentier",status:"Majeure"},{title:"Code article A0004",description:"Description 4",magasin:"Magasin 4",emplacement:"Emplacement magasin 4",quantity:20,date:"21/10/2019",equipement:"Mécanicien en chauffage",status:"Faible"},{title:"Code article A0005",description:"Description 5",magasin:"Magasin 5",emplacement:"Emplacement magasin 5",quantity:3,date:"15/10/2019",equipement:"Serrurier",status:"Majeure"}];this.infoStockModel(e)},_resetOTModel:function(){var e=[{article:"A00001",title:"N° OT 0000001",text:"Tube qui fuit",date:"21/10/2019",equipement:"Trousse de réparation",status:"Faible",prio:"Prio 1",codePoste:"code poste technique 1",description:"Description courte 1",type:"Correctif"},{article:"A00002",title:"N° OT 0000002",text:"Verre brisé",date:"18/10/2019",equipement:"Verre coupé à la taille",status:"Moyenne",prio:"Prio 3",codePoste:"code poste technique 2",description:"Description courte 2",type:"Préventif"},{article:"A00003",title:"N° OT 0000003",text:"Plateau cassé",date:"17/10/2019",equipement:"Charpentier",status:"Majeure",prio:"Prio 3",codePoste:"code poste technique 3",description:"Description courte 3",type:"Correctif"},{article:"A00004",title:"N° OT 0000004",text:"Pas de chauffage",date:"21/10/2019",equipement:"Mécanicien en chauffage",status:"Faible",prio:"Prio 2",codePoste:"code poste technique 4",description:"Description courte 4",type:"Préventif"},{article:"A00005",title:"N° OT 0000005",text:"Casier cassé",date:"15/10/2019",equipement:"Serrurier",status:"Majeure",prio:"Prio 1",codePoste:"code poste technique 5",description:"Description courte 5",type:"Correctif"}];this.followupListModel(e)},onOpenStockDialog:function(e){var i=sap.ui.xmlfragment("com.eramet.maintenanceF5D.view.fragment.stockSelector",this);this.getView().addDependent(i);this._resetModel();if(!t.bNavFromArticle){i.open()}else{if(t.oSelectedOTFull.title!==undefined){this._showMessageToast()}}},onPressOT:function(e){var t=e.getSource().getText().split(" -")[0],i=e.getSource().getText().split("- ")[1],s=i.split("N° OT ")[1].split(" -")[0],a=e.getSource().getText().split(" - ")[2];this.onPressClose();o.show(this.getView().getModel("i18n").getResourceBundle().getText("stockSelectorMT1")+" "+t+" "+this.getView().getModel("i18n").getResourceBundle().getText("stockSelectorMT2")+" "+s+" "+a)},_showMessageToast:function(){var e=t.oSelectedOTFull.title.split("N° OT 000")[1],i=t.oSelectedOTFull.title.split("N° OT")[1],s="Description courte "+t.oSelectedOTFull.title.split("N° OT 000000")[1];this.onPressClose();o.show(this.getView().getModel("i18n").getResourceBundle().getText("stockSelectorMT1")+" "+e+" "+this.getView().getModel("i18n").getResourceBundle().getText("stockSelectorMT2")+" "+i+" "+s)},onPressClose:function(){var e=sap.ui.getCore();e.byId("stockDialog").close();e.byId("stockDialog").destroy()},onPressPostTech:function(){this._openValueHelpDialog()},_openValueHelpDialog:function(e){var t=sap.ui.xmlfragment("com.eramet.maintenanceF5D.view.fragment.valueHelp",this);this.getView().addDependent(t);this._resetModel();t.open()},onPressCloseVH:function(){var e=sap.ui.getCore();e.byId("valueHelpDialog").close();e.byId("valueHelpDialog").destroy()},onPressAdd:function(){var e=sap.ui.getCore().byId("additionalBox"),t=sap.ui.getCore().byId("customList"),i=new sap.m.Label({text:this.getView().getModel("i18n").getResourceBundle().getText("valueHelpText1")}),o=new sap.m.Select({forceSelection:false,items:[new sap.ui.core.Item({text:"{i18n>valueHelpType1}",key:"1"}),new sap.ui.core.Item({text:"{i18n>valueHelpType2}",key:"2"}),new sap.ui.core.Item({text:"{i18n>valueHelpType3}",key:"3"}),new sap.ui.core.Item({text:"{i18n>valueHelpType4}",key:"4"}),new sap.ui.core.Item({text:"{i18n>valueHelpType5}",key:"5"}),new sap.ui.core.Item({text:"{i18n>valueHelpType6}",key:"6"})]}),s=new sap.m.Label({text:this.getView().getModel("i18n").getResourceBundle().getText("valueHelpText2")}),a=new sap.m.Select({forceSelection:false,items:[new sap.ui.core.Item({text:"{i18n>valueHelpFilter1}",key:"1"}),new sap.ui.core.Item({text:"{i18n>valueHelpFilter2}",key:"2"}),new sap.ui.core.Item({text:"{i18n>valueHelpFilter3}",key:"3"}),new sap.ui.core.Item({text:"{i18n>valueHelpFilter4}",key:"4"}),new sap.ui.core.Item({text:"{i18n>valueHelpFilter5}",key:"5"}),new sap.ui.core.Item({text:"{i18n>valueHelpFilter6}",key:"6"}),new sap.ui.core.Item({text:"{i18n>valueHelpFilter7}",key:"7"}),new sap.ui.core.Item({text:"{i18n>valueHelpFilter8}",key:"8"}),new sap.ui.core.Item({text:"{i18n>valueHelpFilter9}",key:"9"}),new sap.ui.core.Item({text:"{i18n>valueHelpFilter10}",key:"10"}),new sap.ui.core.Item({text:"{i18n>valueHelpFilter11}",key:"11"}),new sap.ui.core.Item({text:"{i18n>valueHelpFilter12}",key:"12"}),new sap.ui.core.Item({text:"{i18n>valueHelpFilter13}",key:"13"}),new sap.ui.core.Item({text:"{i18n>valueHelpFilter14}",key:"14"})]}),n=new sap.m.Label({text:this.getView().getModel("i18n").getResourceBundle().getText("valueHelpText3")}),r=new sap.m.Input({});e.addContent(i);e.addContent(o);e.addContent(s);e.addContent(a);e.addContent(n);e.addContent(r);t.addContent(e)},_initStepInputs:function(){var e=this.getView().byId("detailList").getItems();for(var t=0;t<e.length;t++){e[t].getContent()[0].getItems()[4].getItems()[1].setValue("0");if(parseInt(e[t].getContent()[0].getItems()[4].getItems()[1].getValue())===0){e[t].getContent()[0].getItems()[4].getItems()[0].setEnabled(false);e[t].getContent()[0].getItems()[4].getItems()[1].removeStyleClass("customInputTextGreen")}}},onPressDec:function(e){var t=sap.ui.getCore();t.byId(e.getSource().sId).setEnabled(true);t.byId(e.getSource().oParent.oParent.getItems()[4].getItems()[1].sId).removeStyleClass("customInputTextGreen");t.byId(e.getSource().oParent.oParent.getItems()[4].getItems()[2].sId).setEnabled(true);t.byId(e.getSource().oParent.oParent.getItems()[4].getItems()[1].sId).setValue(parseInt(e.getSource().oParent.oParent.getItems()[4].getItems()[1].getValue())-1);var i=e.getSource().sId.split("detailList-")[1];this.getView().getModel("infoStockModel").getData()[i].quantity=parseInt(this.getView().getModel("infoStockModel").getData()[i].quantity)+1;this.getView().getModel("infoStockModel").refresh(true);if(parseInt(e.getSource().oParent.oParent.getItems()[4].getItems()[1].getValue())===0){t.byId(e.getSource().sId).setEnabled(false)}},onPressInc:function(e){var t=sap.ui.getCore();t.byId(e.getSource().oParent.oParent.getItems()[4].getItems()[1].sId).removeStyleClass("customInputTextGreen");t.byId(e.getSource().oParent.oParent.getItems()[4].getItems()[0].sId).setEnabled(true);t.byId(e.getSource().oParent.oParent.getItems()[4].getItems()[1].sId).setValue(parseInt(e.getSource().oParent.oParent.getItems()[4].getItems()[1].getValue())+1);var i=e.getSource().sId.split("detailList-")[1];this.getView().getModel("infoStockModel").getData()[i].quantity=parseInt(this.getView().getModel("infoStockModel").getData()[i].quantity)-1;this.getView().getModel("infoStockModel").refresh(true);if(parseInt(this.getView().getModel("infoStockModel").getData()[i].quantity)===0){t.byId(e.getSource().sId).setEnabled(false);t.byId(e.getSource().oParent.oParent.getItems()[4].getItems()[1].sId).addStyleClass("customInputTextGreen")}},onCheckValue:function(e){var t=sap.ui.getCore(),i=parseInt(e.getSource().getValue()),o=e.getSource().sId.split("detailList-")[1],s=parseInt(this.aOldValues[o]);if(i<=s){t.byId(e.getSource().sId).removeStyleClass("customInputTextGreen");t.byId(e.getSource().oParent.oParent.getItems()[4].getItems()[1].sId).setValue(i);this.getView().getModel("infoStockModel").getData()[o].quantity=s-i;this.getView().getModel("infoStockModel").refresh(true);if(s===0){t.byId(e.getSource().oParent.oParent.getItems()[4].getItems()[2].sId).setEnabled(false)}if(i===0){t.byId(e.getSource().oParent.oParent.getItems()[4].getItems()[0].sId).setEnabled(false)}if(this.getView().getModel("infoStockModel").getData()[o].quantity===0){t.byId(e.getSource().oParent.oParent.getItems()[4].getItems()[2].sId).setEnabled(false);t.byId(e.getSource().oParent.oParent.getItems()[4].getItems()[0].sId).setEnabled(true);t.byId(e.getSource().sId).addStyleClass("customInputTextGreen")}if(this.getView().getModel("infoStockModel").getData()[o].quantity>0){t.byId(e.getSource().oParent.oParent.getItems()[4].getItems()[2].sId).setEnabled(true)}}else{t.byId(e.getSource().oParent.oParent.getItems()[4].getItems()[1].sId).setValue("");this.getView().getModel("infoStockModel").getData()[o].quantity=this.aOldValues[o];this.getView().getModel("infoStockModel").refresh(true)}}})});