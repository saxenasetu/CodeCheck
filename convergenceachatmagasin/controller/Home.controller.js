sap.ui.define(["com/eramet/Convergence_Achat_Magasin/controller/BaseController","com/eramet/Convergence_Achat_Magasin/util/constans","com/eramet/Convergence_Achat_Magasin/util/formatter","com/eramet/Convergence_Achat_Magasin/model/models"],function(e,t,n,s){"use strict";return e.extend("com.eramet.Convergence_Achat_Magasin.controller.Home",{onInit:function(){this.getRouter().attachRoutePatternMatched(this._onRouteMatched,this)},onAfterRendering:function(){this._getServices();this._getPickingList();this._getUnpickedItems()},_onRouteMatched:function(e){if(e.getParameter("name")==="Home"){this.registerNavFrom(this)}},onPressNavToInventaire:function(){this.navTo("Inventaire")},onPressNavToListeServir:function(){this.navTo("ListeServir")},onPressNavToScanBl:function(){this.navTo("ScanBl")},onPressNavToRechercheArticle:function(){this.navTo("RechercheArticle")},onOpenUserSelection:function(){var e=sap.ui.xmlfragment("com.eramet.Convergence_Achat_Magasin.view.fragment.userSelection",this);this.getView().addDependent(e);e.open()},onSelectCustomer:function(e){this._setTiles(e.getSource().sId);this._onCloseCustomerialog()},_onCloseCustomerialog:function(){var e=sap.ui.getCore();e.byId("userSelectionDialog").close();e.byId("userSelectionDialog").destroy()},_getServices:function(){var e=this;var n=com.eramet.Convergence_Achat_Magasin.Component.getMetadata().getManifestEntry("sap.app").dataSources["MM_IM_PHYS_INV_DOC_SRV"].uri;var s=new sap.ui.model.odata.ODataModel(n,true);s.read("/C_PhysInvtryDocHdrObjPage",{success:function(n,s){console.log("success",n.results);t.aListDoc=n.results;e.listDocModel(n);e.getView().byId("inventory").getTileContent()[0].getAggregation("content").setValue(n.results.length)},error:function(e,t){console.log("fail",t)}})},_getPickingList:function(){var e=this;var n=com.eramet.Convergence_Achat_Magasin.Component.getMetadata().getManifestEntry("sap.app").dataSources["API_OUTBOUND_DELIVERY_SRV"].uri;var s=new sap.ui.model.odata.ODataModel(n,true);s.read("/A_OutbDeliveryHeader",{success:function(n,s){console.log("success",n);var a=[];for(var i=0;i<n.results.length;i++){if(n.results[i].OverallPickingStatus!="C"){a.push(n.results[i])}}t.aListServir=a;e.listServirModel(a);e.getView().byId("picking").getTileContent()[0].getAggregation("content").getAggregation("items")[0].setValue(a.length)},error:function(e,t){console.log("fail",t)}})},_getUnpickedItems:function(){var e=this;var t=com.eramet.Convergence_Achat_Magasin.Component.getMetadata().getManifestEntry("sap.app").dataSources["API_OUTBOUND_DELIVERY_SRV"].uri;var n=0;var s=new sap.ui.model.odata.ODataModel(t,true);s.read("/A_OutbDeliveryItem",{success:function(t,s){for(var a=0;a<=t.results.length-1;a++){if(t.results[a].PickingStatus!="C"){n++}}e.getView().byId("picking").getTileContent()[0].getAggregation("content").getAggregation("items")[1].setValue(n)},error:function(e,t){console.log("fail",t)}})},_setTiles:function(e){this.getView().byId("user").setIcon("");this.getView().byId("user").removeStyleClass("green");this.getView().byId("user").removeStyleClass("purple");this.getView().byId("user").removeStyleClass("blue");if(e==="magasinier"){this.getView().byId("user").addStyleClass("green");this.getView().byId("user").setText("M")}else if(e==="depanneur"){this.getView().byId("user").addStyleClass("purple");this.getView().byId("user").setText("D")}else{this.getView().byId("user").addStyleClass("blue");this.getView().byId("user").setText("T")}}})});